# Charles(最强大的http调试工具)详细教程（上）
=======

Charles是目前最强大的http调试工具，在界面和功能上远强于<a href="http://fiddler2.com/" target="_blank">Fiddler</a>，同时是全平台支持，堪称圣杯级工具，唯一的缺陷是这货是收费的，而且是要￥50美元大洋...当然网上是有破解版的，鄙视下自己，无耻地使用了...放在网盘里，亲可以默默带走，不要留下一片云彩。 <a href="http://pan.baidu.com/s/1h7xFL" target="_blank">破解版传送门</a>。 先安装里面的原版，然后copy **charles.jar**覆盖到安装目录下的lib目录即可。这是V3.6版，最新版本是V3.8.3，但破解补丁不通用，会导致无法启动。 <a href="http://www.36ria.com/6278/charles-1" rel="attachment wp-att-6280"><img src="http://www.36ria.com/wp-content/uploads/2013/11/charles-1.png" alt="charles-1" width="594" height="433" class="alignnone size-full wp-image-6280" /></a> 启动后，圣杯的真面目如上图。 Charles有个会话（session，不是指http中的session）的概念，可以理解为浏览器中的tab，这个功能在需要调试多个站点页面时很实用，当你刷新页面的时候，只会在当前session中捕获请求。 （PS：ctrl+N创建个新的session，ctrl+W关闭当前session） Charles的代理服务器启动就可以使用（会提示给firefox安装插件），如果没有捕获到请求，请清理下浏览器缓存。 
## 界面功能初探

<a href="http://www.36ria.com/6278/2-17" rel="attachment wp-att-6283"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2.png" alt="2" width="802" height="474" class="alignnone size-full wp-image-6283" /></a> 工具条包含了Charles的大部分功能： <a href="http://www.36ria.com/6278/1-19" rel="attachment wp-att-6281"><img src="http://www.36ria.com/wp-content/uploads/2013/11/1.png" alt="1" width="869" height="513" class="alignnone size-full wp-image-6281" /></a> 有几个功能比较抽象，后面会详细说明。 右键请求出现菜单，Charles的右键菜单功能比fiddler强大太多了。 <a href="http://www.36ria.com/6278/3-21" rel="attachment wp-att-6284"><img src="http://www.36ria.com/wp-content/uploads/2013/11/3.png" alt="3" width="510" height="481" class="alignnone size-full wp-image-6284" /></a> 双击请求进入列表视图，类似fiddler，方便查看和过滤请求。 Charles的过滤查找功能非常赞，很快速： <a href="http://www.36ria.com/6278/2013-11-16-16-39-14" rel="attachment wp-att-6285"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-16-39-14.png" alt="2013-11-16 16-39-14" width="578" height="285" class="alignnone size-full wp-image-6285" /></a> 请求详情跟fiddler相似，但直观不少： <a href="http://www.36ria.com/6278/4-19" rel="attachment wp-att-6286"><img src="http://www.36ria.com/wp-content/uploads/2013/11/4.png" alt="4" width="607" height="335" class="alignnone size-full wp-image-6286" /></a> 工具视图基本讲解完毕，接下来我们用Charles做点事情。 
## 本地代理和远程代理 Charles的代理服务器端口跟fiddler一样都是8888，即你的本机ip:8888。 

<a href="http://www.36ria.com/6278/2013-11-16-16-58-57" rel="attachment wp-att-6290"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-16-58-57.png" alt="2013-11-16 16-58-57" width="344" height="486" class="alignnone size-full wp-image-6290" /></a> 我们的目标将一个压缩文件代理成本地的源码文件。 点击“Map Local”后： <a href="http://www.36ria.com/6278/2013-11-16-17-01-33" rel="attachment wp-att-6291"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-17-01-33.png" alt="2013-11-16 17-01-33" width="425" height="264" class="alignnone size-full wp-image-6291" /></a> index-min.js代理成index.js，刷新页面试试。 <a href="http://www.36ria.com/6278/2013-11-16-17-03-52" rel="attachment wp-att-6292"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-17-03-52.png" alt="2013-11-16 17-03-52" width="502" height="287" class="alignnone size-full wp-image-6292" /></a> 代理成功，so easy！ Charles的树状视图比fiddler的列表视图好的地方在于，多次刷新后的请求会被归纳到树里面，更加一目了然，用fiddler的时候，有点强迫症的同学，都要点击clear，有木有... Charles是支持子目录代理哦，非常实用的功能：（使用通配符*****） <a href="http://www.36ria.com/6278/2013-11-16-17-11-44" rel="attachment wp-att-6294"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-17-11-44.png" alt="2013-11-16 17-11-44" width="523" height="280" class="alignnone size-full wp-image-6294" /></a> 本地地址选择个子目录，不需要通配符。 
### 如何判断是否代理成功呢？ 这点Charles比fiddler人性化多了。 

<a href="http://www.36ria.com/6278/2013-11-16-17-13-20" rel="attachment wp-att-6295"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-17-13-20.png" alt="2013-11-16 17-13-20" width="689" height="281" class="alignnone size-full wp-image-6295" /></a> 校验是否代理成功，最省力的方式是点击工具条上的刷新按钮，刷新单个请求，如果代理成功，Charles会往“Notes”界面打个log，比如`Mapped to local file: C:\www\htdocs\gallery\uploader\1.5\build\index-min.js`。 
### 去除代理配置 小技巧：所有的配置开关都可以通过工具条上的“工具”设置（倒数第二个按钮）。 去掉代理配置： 

<a href="http://www.36ria.com/6278/2013-11-16-17-34-25" rel="attachment wp-att-6298"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-17-34-25.png" alt="2013-11-16 17-34-25" width="153" height="278" class="alignnone size-full wp-image-6298" /></a> 小技巧：建议开启**No Caching**，不缓存请求。 
### mobile代理功能 手机或平板页面的调试，我们需要把请求代理到pc端的Charles上。 必须确保mobile端和pc端连的是相同的无线网络。 

**ios的配置非常简单** <a href="http://www.36ria.com/6278/t1svwvfn0kxxb1o7go-320-416" rel="attachment wp-att-6300"><img src="http://www.36ria.com/wp-content/uploads/2013/11/T1SvWVFn0kXXb1o7go-320-416.png" alt="T1SvWVFn0kXXb1o7go-320-416" width="320" height="416" class="alignnone size-full wp-image-6300" /></a> （上图借用我同事自寒的截图） 服务器ip设置成pc的ip，端口好设置成8888即可。 然后mobile终端可以刷新试试。 **安卓机器的代理** 首先，安卓机器必须有root权限，其次需要借助app才行，在安卓的任意市场搜索 **ProxyDroid**，灰常好用的代理app。 <a href="http://www.36ria.com/6278/2013-11-18-17-54-41" rel="attachment wp-att-6324"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-18-17-54-41.png" alt="2013-11-18 17-54-41" width="238" height="445" class="alignnone size-full wp-image-6324" /></a> 有些浏览器是自带了代理配置功能，比如opera mobile，输入**opera:config **，不过我试了下没代理成功，不知道是不是手机问题。 wp8的代理设置也很简单，手机连接wifi 并进行设置下 设置--WiFi--长按连接好的WIFI--弹出编辑选项。 
### 试试远程代理

<a href="http://www.36ria.com/6278/2013-11-16-17-39-24" rel="attachment wp-att-6299"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-17-39-24.png" alt="2013-11-16 17-39-24" width="325" height="365" class="alignnone size-full wp-image-6299" /></a> 
### 代理配置

<a href="http://www.36ria.com/6278/2013-11-16-17-26-43" rel="attachment wp-att-6296"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-17-26-43.png" alt="2013-11-16 17-26-43" width="280" height="326" class="alignnone size-full wp-image-6296" /></a> <a href="http://www.36ria.com/6278/2013-11-16-17-27-23" rel="attachment wp-att-6297"><img src="http://www.36ria.com/wp-content/uploads/2013/11/2013-11-16-17-27-23.png" alt="2013-11-16 17-27-23" width="429" height="286" class="alignnone size-full wp-image-6297" /></a> Charles支持https和sockets的代理，还支持SSL，非常全面。 
